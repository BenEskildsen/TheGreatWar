<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>GameGroup.js - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../../../";
</script>

<script src="../../../../../js/jquery.js"></script>
<script src="../../../../../js/darkfish.js"></script>

<link href="../../../../../css/fonts.css" rel="stylesheet">
<link href="../../../../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../../../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../../../../Gemfile~.html">Gemfile~</a>
  
    <li><a href="../../../../../Guardfile.html">Guardfile</a>
  
    <li><a href="../../../../../README_md.html">README</a>
  
    <li><a href="../../../../../README_rdoc.html">README</a>
  
    <li><a href="../../../../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../../../../app/assets/images/minecraftia_fnt.html">minecraftia.fnt</a>
  
    <li><a href="../../../../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/client_test_js.html">client_test.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/gamas_coffee.html">gamas.coffee</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/main_js.html">main.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/prefabs/GameBoard_js.html">GameBoard.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/prefabs/GameGroup_js.html">GameGroup.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/prefabs/UIGroup_js.html">UIGroup.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/prefabs/Unit_js.html">Unit.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/prefabs/UnitGroup_js.html">UnitGroup.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/prefabs/actions_js.html">actions.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/states/boot_js.html">boot.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/states/gameover_js.html">gameover.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/states/menu_js.html">menu.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/states/play_js.html">play.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/game/states/preload_js.html">preload.js</a>
  
    <li><a href="../../../../../app/assets/javascripts/sessions_coffee.html">sessions.coffee</a>
  
    <li><a href="../../../../../app/assets/javascripts/static_pages_coffee.html">static_pages.coffee</a>
  
    <li><a href="../../../../../app/assets/javascripts/users_coffee.html">users.coffee</a>
  
    <li><a href="../../../../../app/assets/json/demo_json.html">demo.json</a>
  
    <li><a href="../../../../../app/assets/json/tiledTest_json.html">tiledTest.json</a>
  
    <li><a href="../../../../../app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="../../../../../app/assets/stylesheets/css/list-objects_css.html">list-objects.css</a>
  
    <li><a href="../../../../../app/assets/stylesheets/css/military-styles_css.html">military-styles.css</a>
  
    <li><a href="../../../../../app/assets/stylesheets/css/navigation_css.html">navigation.css</a>
  
    <li><a href="../../../../../app/assets/stylesheets/custom_css_scss.html">custom.css.scss</a>
  
    <li><a href="../../../../../app/assets/stylesheets/games_scss.html">games.scss</a>
  
    <li><a href="../../../../../app/assets/stylesheets/scaffolds_scss.html">scaffolds.scss</a>
  
    <li><a href="../../../../../app/assets/stylesheets/sessions_scss.html">sessions.scss</a>
  
    <li><a href="../../../../../app/assets/stylesheets/static_pages_scss.html">static_pages.scss</a>
  
    <li><a href="../../../../../app/assets/stylesheets/users_scss.html">users.scss</a>
  
    <li><a href="../../../../../app/models/ecs/CodingPractices_txt.html">CodingPractices</a>
  
    <li><a href="../../../../../app/models/ecs/READ_ME_txt.html">READ_ME</a>
  
    <li><a href="../../../../../app/models/ecs/system/AttackSystemDoc_txt.html">AttackSystemDoc</a>
  
    <li><a href="../../../../../app/models/ecs/system/MovementSystem.html">MovementSystem</a>
  
    <li><a href="../../../../../app/views/gamas/index_json_jbuilder.html">index.json.jbuilder</a>
  
    <li><a href="../../../../../app/views/gamas/show_json_jbuilder.html">show.json.jbuilder</a>
  
    <li><a href="../../../../../config_ru.html">config.ru</a>
  
    <li><a href="../../../../../coverage/assets/0_9_0/application_css.html">application.css</a>
  
    <li><a href="../../../../../coverage/assets/0_9_0/application_js.html">application.js</a>
  
    <li><a href="../../../../../coverage/index_html.html">index.html</a>
  
    <li><a href="../../../../../log/development_log.html">development.log</a>
  
    <li><a href="../../../../../log/test_log.html">test.log</a>
  
    <li><a href="../../../../../log/websocket_rails_log.html">websocket_rails.log</a>
  
    <li><a href="../../../../../public/404_html.html">404.html</a>
  
    <li><a href="../../../../../public/422_html.html">422.html</a>
  
    <li><a href="../../../../../public/500_html.html">500.html</a>
  
    <li><a href="../../../../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../../../../public/robots_txt.html">robots</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/controllers/application_controller_rb_cyclo_html.html">application_controller.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/controllers/socket_controller_rb_cyclo_html.html">socket_controller.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/controllers/static_pages_controller_rb_cyclo_html.html">static_pages_controller.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/helpers/application_helper_rb_cyclo_html.html">application_helper.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/helpers/static_pages_helper_rb_cyclo_html.html">static_pages_helper.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/Game_rb_cyclo_html.html">Game.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/ai_component_rb_cyclo_html.html">ai_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/component_rb_cyclo_html.html">component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/energy_component_rb_cyclo_html.html">energy_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/energy_module_rb_cyclo_html.html">energy_module.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/health_component_rb_cyclo_html.html">health_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/human_component_rb_cyclo_html.html">human_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/impassable_component_rb_cyclo_html.html">impassable_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/melee_attack_component_rb_cyclo_html.html">melee_attack_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/motion_component_rb_cyclo_html.html">motion_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/name_component_rb_cyclo_html.html">name_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/occupiable_component_rb_cyclo_html.html">occupiable_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/owned_component_rb_cyclo_html.html">owned_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/piece_component_rb_cyclo_html.html">piece_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/position_component_rb_cyclo_html.html">position_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/range_attack_component_rb_cyclo_html.html">range_attack_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/range_attack_immunity_component_rb_cyclo_html.html">range_attack_immunity_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/terrain_component_rb_cyclo_html.html">terrain_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/trashed_components/ArmyComponent_rb_cyclo_html.html">ArmyComponent.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/trashed_components/GridComponent_rb_cyclo_html.html">GridComponent.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/turn_component_rb_cyclo_html.html">turn_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/component/user_id_component_rb_cyclo_html.html">user_id_component.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/entity/component_bag_rb_cyclo_html.html">component_bag.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/entity/entity_rb_cyclo_html.html">entity.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/entity/entity_factory_rb_cyclo_html.html">entity_factory.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/entity/entity_manager_rb_cyclo_html.html">entity_manager.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/entity/entity_type_rb_cyclo_html.html">entity_type.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/entity/json_factory_rb_cyclo_html.html">json_factory.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/DamageSystem_rb_cyclo_html.html">DamageSystem.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/KillSystem_rb_cyclo_html.html">KillSystem.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/MoveSystem_rb_cyclo_html.html">MoveSystem.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/damage_system_rb_cyclo_html.html">damage_system.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/energy_system_rb_cyclo_html.html">energy_system.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/kill_system_rb_cyclo_html.html">kill_system.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/range_system_rb_cyclo_html.html">range_system.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/system_rb_cyclo_html.html">system.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/models/ecs/system/turn_system_rb_cyclo_html.html">turn_system.rb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/views/layouts/application_html_erb_cyclo_html.html">application.html.erb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/app/views/static_pages/index_html_erb_cyclo_html.html">index.html.erb_cyclo.html</a>
  
    <li><a href="../../../../../tmp/metric_fu/scratch/saikuro/index_cyclo_html.html">index_cyclo.html</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page app/assets/javascripts/game/prefabs/GameGroup.js">

<p>&#39;use strict&#39;;</p>

<p>var GameGroup = function(game, parent) {</p>

<pre>Phaser.Group.call(this, game, parent);

this.gameBoard = new GameBoard(this.game);
this.selected = null;
this.unitGroup = new UnitGroup(this.game);

this.marker = this.game.add.graphics();
this.marker.lineStyle(2, 0x000000, 1);
this.marker.drawRect(0, 0, this.game.constants.TILE_SIZE, this.game.constants.TILE_SIZE);
this.tile = null;

this.action = null;

this.turn = null;
this.turnCount = null;

this.players = null;
this.game.constants.PLAYER_ID = null;
// How are we going to do player names and stuff?

this.ui = new UIGroup(this.game);
this.ui.gameGroup = this;</pre>

<p>};</p>

<p>GameGroup.prototype = Object.create(Phaser.Group.prototype);
GameGroup.prototype.constructor = GameGroup;</p>

<p>GameGroup.prototype.myTurn = function() {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">turn</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">game</span>.<span class="ruby-identifier">constants</span>.<span class="ruby-constant">PLAYER_ID</span>;
</pre>

<p>}</p>

<p>GameGroup.prototype.update = function(mouse) {</p>

<pre>// moving the marker
this.marker.x = this.gameBoard.highlightLayer.getTileX(this.game.input.activePointer.worldX) * this.game.constants.TILE_SIZE;
this.marker.y = this.gameBoard.highlightLayer.getTileY(this.game.input.activePointer.worldY) * this.game.constants.TILE_SIZE;

this.tile = this.gameBoard.getTile(this.marker.x/this.game.constants.TILE_SIZE,
                                   this.marker.y/this.game.constants.TILE_SIZE,
                                   this.gameBoard.terrainLayer);

if (this.game.input.mousePointer.targetObject &amp;&amp;
    this.game.input.mousePointer.targetObject.sprite instanceof Unit) {
    this.unit = this.game.input.mousePointer.targetObject.sprite;
} else {
    this.unit = null;
}

if (this.selected) {
    this.tile.name = &#39;Flatland&#39;;
    this.ui.setSecondaryTile(this.tile);
    this.ui.setSecondaryUnit(this.unit);
} else {
    this.ui.setSecondaryTile(null);
    this.ui.setSecondaryUnit(null);
    this.tile.name = &#39;Flatland&#39;;
    this.ui.setPrimaryTile(this.tile);
    this.ui.setPrimaryUnit(this.unit);
}

this.ui.checkPlayerInfoUIPosition({x: this.game.input.mousePointer.x,
                                   y: this.game.input.mousePointer.y});

// check if end turn or end game
this.game.input.keyboard.onDownCallback = (function(key) {
    var z = 90;
    var q = 81;

    if (key.keyCode === z) {
        this.game.dispatcher.rpc(&quot;end_turn&quot;, []); // backend will know whose turn to end
        this.resetEnergy(this.turn);
    } else if (key.keyCode === q) {
        this.game.dispatcher.rpc(&quot;leave_game&quot;, []);
    }
}).bind(this);</pre>

<p>}</p>

<p>GameGroup.prototype.eliminatePlayer = function(playerId) {</p>

<p>}</p>

<p>GameGroup.prototype.gameOver = function(playerId) {</p>

<pre>if (this.player == playerId) {
    this.game.endGameMessage = &quot;You Win!&quot;
} else {
    this.game.endGameMessage = &quot;You Lose!&quot;
}
this.game.state.start(&#39;gameover&#39;);</pre>

<p>}</p>

<p>GameGroup.prototype.onClick = function(targetObject) {</p>

<pre>if (targetObject === null) {
    this.tileClicked();
} else if (targetObject.sprite instanceof Unit) {
    this.unitClicked(targetObject.sprite);
} else if (targetObject.sprite instanceof Phaser.Button) {
    this.buttonClicked(targetObject.sprite);
}</pre>

<p>}</p>

<p>GameGroup.prototype.tileClicked = function() {</p>

<pre>if (!this.myTurn())
    return;
// tile
if (this.selected) {
    if (this.gameBoard.isHighlighted(this.tile.x, this.tile.y)) {
        switch (this.action) {
        case &#39;move&#39;:
            this.game.dispatcher.rpc(&quot;move_unit&quot;, [
                this.selected.id,
                {
                    x: this.tile.x,
                    y: this.tile.y
                }
            ]);
            break;
        case &#39;ranged&#39;:
            break;
        case &#39;melee&#39;:
            break;
        }
    }
    this.selected = null;
    this.action = null;
    this.gameBoard.unhighlightAll();
    this.ui.hideMenu().start();
}</pre>

<p>}</p>

<p>GameGroup.prototype.unitClicked = function(unit) {</p>

<pre>if (!this.myTurn())
    return;

if (this.action) {
    this.interact(unit);
} else {
    this.select(unit);
}</pre>

<p>}</p>

<p>GameGroup.prototype.interact = function(unit) {</p>

<pre>if (this.gameBoard.isHighlighted(this.tile.x, this.tile.y)) {
    if (unit.isMine()) {
        // maybe later we have within-team interaction
        this.select(unit); // just select the clicked unit for now though
    } else {
        // clicked enemy unit
        if ((this.action === &#39;ranged&#39; || this.action === &#39;melee&#39;)) {
            this.game.dispatcher.rpc(&quot;attack&quot;, [
                this.selected.id,
                {x: this.tile.x, y: this.tile.y},
                this.action
            ]);
            this.selected = null;
        }
    }
    this.gameBoard.unhighlightAll();
    this.action = null;
}</pre>

<p>}</p>

<p>GameGroup.prototype.select = function(unit) {</p>

<pre>if (unit.isMine() &amp;&amp; !this.game.animatingAction) {
    this.selected = unit;
    this.ui.setPrimaryUnit(this.selected);
    this.gameBoard.unhighlightAll();
    this.action = null;
    this.game.dispatcher.rpc(&quot;get_unit_actions&quot;, [this.selected.id]);
}</pre>

<p>}</p>

<p>GameGroup.prototype.buttonClicked = function(button) {</p>

<pre>if (button.key.substring(0, &quot;ui-&quot;) === &quot;ui-&quot;) {
    var action = button.key.replace(&#39;ui-&#39;, &#39;&#39;);
    switch (action) {
    case &#39;expand&#39;:
        this.ui.showPlayerMenu();
        break;
    case &#39;contract&#39;:
        break;
    }
} else {
    this.action = button.key.replace(&#39;action-&#39;, &#39;&#39;);
    this.ui.hideMenu().start();

    switch (this.action) {
    case &#39;move&#39;:
        this.game.dispatcher.rpc(&quot;get_unit_moves&quot;, [this.selected.id]);
        break;
    case &#39;ranged&#39;:
        this.game.dispatcher.rpc(&quot;get_unit_ranged_attacks&quot;, [this.selected.id]);
        break;
    case &#39;melee&#39;:
        this.game.dispatcher.rpc(&quot;get_unit_melee_attacks&quot;, [this.selected.id]);
        break;
    case &#39;endTurn&#39;:
        // this.game.dispatcher.rpc(&quot;end_turn&quot;, [this.turn]);
        this.resetEnergy(this.turn);
        break;
    }
}</pre>

<p>}</p>

<p>GameGroup.prototype.initGame = function(board, units, turn, players, me) {</p>

<pre>var action = {
    gameGroup: this
};

action.start = function() {
    this.gameGroup.game.world.setBounds(0, 0, board.width * 32, board.height * 32);

    for (var i = 0; i &lt; board.width; i++) {
            for (var j = 0; j &lt; board.height; j++) {
                this.gameGroup.gameBoard.setTile(i, j, board.squares[j*board.width+i].index);
                // if (board.squares[i*board.width+j].fow)
                //  this.gameGroup.gameBoard.addFog(i, j);
            }
    }

    // effects is not passed right now
    // this.gameGroup.gameBoard.effects = effects;

    for (var i = 0; i &lt; units.length; i++) {
        this.gameGroup.unitGroup.addUnit(units[i].id,
                                         units[i].type,
                                         units[i].x,
                                         units[i].y,
                                         units[i].player,
                                         units[i].stats,
                                         players[units[i].player].faction);
    }

    this.gameGroup.turn = turn.playerid;
    this.gameGroup.turnCount = turn.turnCount;
    this.gameGroup.players = players; // id corresponds to obj with name + type (red/blue)
    this.gameGroup.game.constants.PLAYER_ID = me;

    var playerIds = Object.keys(players);
    for (var i = 0; i &lt; playerIds.length; i++) {
        this.gameGroup.game.load.image(playerIds[i], players[playerIds[i]].gravatar);
    }

    this.gameGroup.game.load.onLoadComplete.add(function() {
        this.gameGroup.ui.setPlayer(turn.playerid, this.gameGroup.players[turn.playerid], this.gameGroup.turnCount);
        this.onComplete();
    }, this)
    this.gameGroup.game.load.start();
}

return action;</pre>

<p>}</p>

<p>GameGroup.prototype.showUnitActions = function(unitActions) {</p>

<pre>var action = {
    gameGroup: this
};
action.start = function() {
    if (this.gameGroup.ui.menuVisible()) {
        var hideTween = this.gameGroup.ui.hideMenu();
        hideTween.onComplete.add(function() {
            var showTween = this.gameGroup.ui.showMenu(this.gameGroup.selected, unitActions);
            showTween.onComplete.add(this.onComplete, this);
            showTween.start();
        }, this);
        hideTween.start();
    } else {
        var showTween = this.gameGroup.ui.showMenu(this.gameGroup.selected, unitActions);
        showTween.onComplete.add(this.onComplete, this);
        showTween.start();
    }
};
return action;</pre>

<p>}</p>

<p>GameGroup.prototype.highlightSquares = function(type, squares) {</p>

<pre>var action = {
    squares: squares,
    gameBoard: this.gameBoard,
    type: type
};
action.start = function() {
    for (var i = 0, square; square = this.squares[i]; i++) {
        var tile = this.gameBoard.getTile(square.x, square.y, this.gameBoard.terrainLayer);
        this.gameBoard.highlight(tile.x, tile.y, type);
    }
    this.onComplete();
};
return action;</pre>

<p>}</p>

<p>GameGroup.prototype.revealFog = function(squares) {</p>

<pre>var action = {
    squares: squares,
    gameBoard: this.gameBoard
};
action.start = function() {
    for (var i = 0, square; square = this.squares[i]; i++) {
        var tile = this.gameBoard.getTile(square.x, square.y, this.gameBoard.terrainLayer);
        this.gameBoard.revealFog(tile.x, tile.y);
    }
    this.onComplete();
};
return action;</pre>

<p>}</p>

<p>GameGroup.prototype.resetEnergy = function(playerId) {</p>

<pre>var units = this.unitGroup.getAllByPlayer(playerId);
for (var i = 0, unit; unit = units[i]; i++) {
    unit.stats.energy.current = unit.stats.energy.max;
}</pre>

<p>}</p>

<p>GameGroup.prototype.updateUnitHealth = function(unit, health) {</p>

<pre class="ruby"><span class="ruby-identifier">var</span> <span class="ruby-identifier">action</span> = {
    <span class="ruby-identifier">ui</span><span class="ruby-operator">:</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">ui</span>,
    <span class="ruby-identifier">unit</span><span class="ruby-operator">:</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">unitGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">unit</span>)
}
<span class="ruby-identifier">action</span>.<span class="ruby-identifier">start</span> = <span class="ruby-identifier">function</span>() {
    <span class="ruby-identifier">this</span>.<span class="ruby-identifier">tween</span> = <span class="ruby-identifier">this</span>.<span class="ruby-identifier">ui</span>.<span class="ruby-identifier">updateHealth</span>(<span class="ruby-identifier">action</span>.<span class="ruby-identifier">unit</span>, <span class="ruby-identifier">health</span>, <span class="ruby-identifier">this</span>.<span class="ruby-identifier">onComplete</span>, <span class="ruby-identifier">this</span>);
    <span class="ruby-identifier">this</span>.<span class="ruby-identifier">tween</span>.<span class="ruby-identifier">start</span>();
}
<span class="ruby-keyword">return</span> <span class="ruby-identifier">action</span>;
</pre>

<p>}</p>

<p>GameGroup.prototype.updateUnitEnergy = function(unitId, energyValue) {</p>

<pre class="ruby"><span class="ruby-identifier">var</span> <span class="ruby-identifier">action</span> = {
    <span class="ruby-identifier">unit</span><span class="ruby-operator">:</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">unitGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">unitId</span>),
    <span class="ruby-identifier">ui</span><span class="ruby-operator">:</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">ui</span>
};

<span class="ruby-identifier">action</span>.<span class="ruby-identifier">start</span> = <span class="ruby-identifier">function</span>() {
    <span class="ruby-identifier">this</span>.<span class="ruby-identifier">tween</span> = <span class="ruby-identifier">this</span>.<span class="ruby-identifier">ui</span>.<span class="ruby-identifier">updateEnergy</span>(<span class="ruby-identifier">action</span>.<span class="ruby-identifier">unit</span>, <span class="ruby-identifier">energyValue</span>, <span class="ruby-identifier">this</span>.<span class="ruby-identifier">onComplete</span>, <span class="ruby-identifier">this</span>);
    <span class="ruby-identifier">this</span>.<span class="ruby-identifier">tween</span>.<span class="ruby-identifier">start</span>();
};
<span class="ruby-keyword">return</span> <span class="ruby-identifier">action</span>;
</pre>

<p>}</p>

<p>GameGroup.prototype.attack = function(unitId, square, type, unitType) {</p>

<pre>// check if need to add an animation to the receiving square
var action = {
    unit: this.unitGroup.find(unitId),
    unitGroup: this.unitGroup
};

action.start = function() {
    this.tween = this.unit.attack(square, type);
    this.tween.onComplete.add(this.onComplete, this);
    this.tween.start();
}
return action;</pre>

<p>}</p>

<p>GameGroup.prototype.moveUnit = function(unitId, squares) {</p>

<pre>var action = {};
action.unit = this.unitGroup.find(unitId);
action.move = function(squares) {
    if (squares.length === 1) {
        this.unit.moveTo(squares[0].x, squares[0].y, true, this.onComplete, this);
        return;
    }
    this.unit.moveTo(squares[0].x, squares[0].y, false, function() {
        this.move(squares.slice(1))
    }, this);
}
action.start = function() {
    this.move(squares);
}
return action;</pre>

<p>}</p>

<p>GameGroup.prototype.revealUnit = function(unit) {</p>

<pre class="ruby"><span class="ruby-identifier">var</span> <span class="ruby-identifier">addedUnit</span> = <span class="ruby-identifier">this</span>.<span class="ruby-identifier">unitGroup</span>.<span class="ruby-identifier">addUnit</span>(<span class="ruby-identifier">unit</span>.<span class="ruby-identifier">id</span>,
                                       <span class="ruby-identifier">unit</span>.<span class="ruby-identifier">type</span>,
                                       <span class="ruby-identifier">unit</span>.<span class="ruby-identifier">x</span>,
                                       <span class="ruby-identifier">unit</span>.<span class="ruby-identifier">y</span>,
                                       <span class="ruby-identifier">unit</span>.<span class="ruby-identifier">player</span>,
                                       <span class="ruby-identifier">unit</span>.<span class="ruby-identifier">stats</span>,
                                       <span class="ruby-identifier">this</span>.<span class="ruby-identifier">players</span>[<span class="ruby-identifier">unit</span>.<span class="ruby-identifier">player</span>].<span class="ruby-identifier">faction</span>);
<span class="ruby-identifier">addedUnit</span>.<span class="ruby-identifier">alpha</span> = <span class="ruby-value">0</span>;
<span class="ruby-keyword">return</span> <span class="ruby-identifier">new</span> <span class="ruby-constant">TweenAction</span>(<span class="ruby-identifier">this</span>.<span class="ruby-identifier">game</span>.<span class="ruby-identifier">add</span>.<span class="ruby-identifier">tween</span>(<span class="ruby-identifier">addedUnit</span>).<span class="ruby-identifier">to</span>({<span class="ruby-identifier">alpha</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>}, <span class="ruby-value">300</span>));
</pre>

<p>}</p>

<p>GameGroup.prototype.killUnits = function(unitIds) {</p>

<pre class="ruby"><span class="ruby-identifier">var</span> <span class="ruby-identifier">action</span> = {};
<span class="ruby-identifier">action</span>.<span class="ruby-identifier">unitGroup</span> = <span class="ruby-identifier">this</span>.<span class="ruby-identifier">unitGroup</span>;
<span class="ruby-identifier">action</span>.<span class="ruby-identifier">units</span> = <span class="ruby-identifier">unitIds</span>.<span class="ruby-identifier">map</span>(<span class="ruby-identifier">function</span>(<span class="ruby-identifier">unitId</span>) {
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">unitGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">unitId</span>);
}, <span class="ruby-identifier">this</span>);
<span class="ruby-identifier">action</span>.<span class="ruby-identifier">tweens</span> = <span class="ruby-identifier">unitIds</span>.<span class="ruby-identifier">map</span>(<span class="ruby-identifier">function</span>(<span class="ruby-identifier">unitId</span>, <span class="ruby-identifier">i</span>) {
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">game</span>.<span class="ruby-identifier">add</span>.<span class="ruby-identifier">tween</span>(<span class="ruby-identifier">action</span>.<span class="ruby-identifier">units</span>[<span class="ruby-identifier">i</span>]).<span class="ruby-identifier">to</span>({<span class="ruby-identifier">alpha</span><span class="ruby-operator">:</span> <span class="ruby-value">0</span>}, <span class="ruby-value">300</span>);
}, <span class="ruby-identifier">this</span>);
<span class="ruby-identifier">action</span>.<span class="ruby-identifier">start</span> = <span class="ruby-identifier">function</span>() {
    <span class="ruby-identifier">this</span>.<span class="ruby-identifier">tweens</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">onComplete</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">function</span>() {
        <span class="ruby-identifier">this</span>.<span class="ruby-identifier">onComplete</span>();
    }, <span class="ruby-identifier">this</span>);
    <span class="ruby-identifier">this</span>.<span class="ruby-identifier">tweens</span>.<span class="ruby-identifier">map</span>(<span class="ruby-identifier">function</span>(<span class="ruby-identifier">tween</span>, <span class="ruby-identifier">i</span>) {
        <span class="ruby-identifier">tween</span>.<span class="ruby-identifier">onComplete</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">function</span>() {
            <span class="ruby-identifier">this</span>.<span class="ruby-identifier">unitGroup</span>.<span class="ruby-identifier">removeUnit</span>(<span class="ruby-identifier">this</span>.<span class="ruby-identifier">units</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">id</span>);
        }, <span class="ruby-identifier">this</span>);
    }, <span class="ruby-identifier">this</span>);
    <span class="ruby-identifier">this</span>.<span class="ruby-identifier">tweens</span>.<span class="ruby-identifier">map</span>(<span class="ruby-identifier">function</span>(<span class="ruby-identifier">tween</span>, <span class="ruby-identifier">i</span>) {
        <span class="ruby-identifier">tween</span>.<span class="ruby-identifier">start</span>();
    }, <span class="ruby-identifier">this</span>);
}
<span class="ruby-keyword">return</span> <span class="ruby-identifier">action</span>;
</pre>

<p>}</p>

<p>GameGroup.prototype.setTurn = function(playerId, turnCount) {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> {
    <span class="ruby-identifier">gameGroup</span><span class="ruby-operator">:</span> <span class="ruby-identifier">this</span>,
    <span class="ruby-identifier">ui</span><span class="ruby-operator">:</span> <span class="ruby-identifier">this</span>.<span class="ruby-identifier">ui</span>,
    <span class="ruby-identifier">start</span><span class="ruby-operator">:</span> <span class="ruby-identifier">function</span>() {
        <span class="ruby-identifier">this</span>.<span class="ruby-identifier">gameGroup</span>.<span class="ruby-identifier">turn</span> = <span class="ruby-identifier">playerId</span>;
        <span class="ruby-identifier">this</span>.<span class="ruby-identifier">gameGroup</span>.<span class="ruby-identifier">turnCount</span> = <span class="ruby-identifier">turnCount</span>;
        <span class="ruby-identifier">this</span>.<span class="ruby-identifier">ui</span>.<span class="ruby-identifier">setPlayer</span>(<span class="ruby-identifier">playerId</span>, <span class="ruby-identifier">this</span>.<span class="ruby-identifier">gameGroup</span>.<span class="ruby-identifier">players</span>[<span class="ruby-identifier">playerId</span>], <span class="ruby-identifier">turnCount</span>);
        <span class="ruby-identifier">this</span>.<span class="ruby-identifier">onComplete</span>();
    }
}
</pre>

<p>}</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

