<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class JsonFactory - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-actions">::actions</a>
    
    <li ><a href="#method-c-attack_animate">::attack_animate</a>
    
    <li ><a href="#method-c-board">::board</a>
    
    <li ><a href="#method-c-end_turn">::end_turn</a>
    
    <li ><a href="#method-c-game_start">::game_start</a>
    
    <li ><a href="#method-c-kill_units">::kill_units</a>
    
    <li ><a href="#method-c-locations">::locations</a>
    
    <li ><a href="#method-c-melee_attack">::melee_attack</a>
    
    <li ><a href="#method-c-melee_attackable_locations">::melee_attackable_locations</a>
    
    <li ><a href="#method-c-move">::move</a>
    
    <li ><a href="#method-c-moveable_locations">::moveable_locations</a>
    
    <li ><a href="#method-c-piece">::piece</a>
    
    <li ><a href="#method-c-piece_xy">::piece_xy</a>
    
    <li ><a href="#method-c-player">::player</a>
    
    <li ><a href="#method-c-range_attackable_locations">::range_attackable_locations</a>
    
    <li ><a href="#method-c-ranged_attack">::ranged_attack</a>
    
    <li ><a href="#method-c-remove_player">::remove_player</a>
    
    <li ><a href="#method-c-square">::square</a>
    
    <li ><a href="#method-c-square_path">::square_path</a>
    
    <li ><a href="#method-c-turn">::turn</a>
    
    <li ><a href="#method-c-update_energy">::update_energy</a>
    
    <li ><a href="#method-c-update_health">::update_health</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-JsonFactory">
  <h1 id="class-JsonFactory" class="class">
    class JsonFactory
  </h1>

  <section class="description">
    
<p>#Dir[File.dirname(__FILE__) + &#39;/../component/*.rb&#39;].each {|file|
require_relative file } #Dir[File.dirname(__FILE__) +
&#39;/../system/*.rb&#39;].each {|file| require_relative file }
#Dir[File.dirname(__FILE__) + &#39;/./*.rb&#39;].each {|file|
require_relative file }</p>

<pre>The JsonFactory is the one stop shop for all things json. Have some actions
or entities to send to the frontend? JsonFactory has you covered. It will
handle both sending newly created entities as well as update actions like
movement and attack to the frontend.

Note: It is the responsibility of the caller to ensure that the entities
are well-formed.</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-actions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">actions</span><span
            class="method-args">(entity_manager, entity, can_move, can_melee, can_range)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="actions-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 484</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">actions</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>, <span class="ruby-identifier">can_move</span>, <span class="ruby-identifier">can_melee</span>, <span class="ruby-identifier">can_range</span>)

        <span class="ruby-identifier">actions</span> = []

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">can_move</span>
         <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">push</span>({<span class="ruby-string">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;move&quot;</span>,
                       <span class="ruby-string">&quot;cost&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entity_manager</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-constant">MotionComponent</span>].<span class="ruby-identifier">first</span>.<span class="ruby-identifier">energy_cost</span>})
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">can_melee</span>
         <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">push</span>({<span class="ruby-string">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;melee&quot;</span>,
                       <span class="ruby-string">&quot;cost&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entity_manager</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-constant">MeleeAttackComponent</span>].<span class="ruby-identifier">first</span>.<span class="ruby-identifier">energy_cost</span>})
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">can_range</span>
         <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">push</span>({<span class="ruby-string">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;ranged&quot;</span>,
                       <span class="ruby-string">&quot;cost&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entity_manager</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-constant">RangeAttackComponent</span>].<span class="ruby-identifier">first</span>.<span class="ruby-identifier">energy_cost</span>})
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">return</span> [{<span class="ruby-string">&quot;action&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;showUnitActions&quot;</span>,
                <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">actions</span>]}]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-attack_animate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attack_animate</span><span
            class="method-args">(entity_manager, type, attacking_entity, attacker_type, target_row, target_col)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This function converts an attack result information into an rpc for the
front end. In particular, it has all necessary information rcorded by the
attack systems. Once an entity dies, it is removed from the entity manager.
Hence, it would be futile to search for it. Hence, everything needed has to
be specified</p>

<p>Arguments</p>

<pre>entity_manager   = manager of entities
type             = the type of the attack
attacking_entity = the entity launching the attack.
attacker_type    = the piece type of the attackign entity.
target_row       = the row of the targeted entity
target_col       = the col of the targeted enitty</pre>

<p>Returns</p>

<pre>a hash ready to be sent to the frontend.</pre>
          
          

          
          <div class="method-source-code" id="attack_animate-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 330</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">attack_animate</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">attacking_entity</span>, <span class="ruby-identifier">attacker_type</span>, <span class="ruby-identifier">target_row</span>, <span class="ruby-identifier">target_col</span>)
          <span class="ruby-keyword">return</span> [{<span class="ruby-string">&quot;action&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;attack&quot;</span>,
                   <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span>
                      [<span class="ruby-identifier">attacking_entity</span>,
                       {<span class="ruby-string">&quot;y&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">target_row</span>,
                        <span class="ruby-string">&quot;x&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">target_col</span>
                         },
                       <span class="ruby-identifier">type</span>,
                       <span class="ruby-identifier">attacker_type</span>]}]
  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-board" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">board</span><span
            class="method-args">(entity_manager)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Converts the board into a json-ready hash. This method is particularly
useful for initialization of the frontend and sending the frontend the data
for the board.</p>

<p>Argumetns</p>

<pre class="ruby"><span class="ruby-identifier">entity_manager</span> = <span class="ruby-identifier">the</span> <span class="ruby-identifier">manager</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">contains</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">board</span>
</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="board-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 190</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">board</span>(<span class="ruby-identifier">entity_manager</span>)
        <span class="ruby-identifier">board_array</span> = []
        (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">row</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
                (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">col</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">board_array</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">square</span>(<span class="ruby-identifier">entity_manager</span>,
                                <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">board</span>[<span class="ruby-identifier">row</span>][<span class="ruby-identifier">col</span>][<span class="ruby-value">0</span>])
                }
        }
        <span class="ruby-keyword">return</span> {<span class="ruby-string">&quot;width&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">row</span>,
                <span class="ruby-string">&quot;height&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">col</span>,
                <span class="ruby-string">&quot;squares&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">board_array</span>}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-end_turn" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">end_turn</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Converts a turn entity into a hash object.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager in which the entity is kept.
entity         = the turn entity to be jsoned</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="end_turn-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 477</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">end_turn</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
  <span class="ruby-identifier">turnHash</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">turn</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
        <span class="ruby-keyword">return</span> [{<span class="ruby-string">&quot;action&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;setTurn&quot;</span>,
                <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">turnHash</span>[<span class="ruby-string">&quot;playerid&quot;</span>], <span class="ruby-identifier">turnHash</span>[<span class="ruby-string">&quot;turnCount&quot;</span>]]}]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-game_start" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">game_start</span><span
            class="method-args">(entity_manager, player_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method is responsible for sending all relevant game start data to the
frontend. Once the frontend receives this, it will be able to completely
initialize the browser for a new game.</p>

<p>Arguments</p>

<pre class="ruby"><span class="ruby-identifier">entity_manager</span> = <span class="ruby-identifier">the</span> <span class="ruby-identifier">manager</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">entities</span>
</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="game_start-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 257</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">game_start</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">player_id</span>)
  <span class="ruby-identifier">player_hash</span> = {}
  <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">each_entity</span>(<span class="ruby-constant">UserIdComponent</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">player</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">player_hash</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">player</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">player</span>)
  }

  <span class="ruby-identifier">turn</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_entities_with_components</span>(<span class="ruby-constant">TurnComponent</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">turn_hash</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">turn</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">turn</span>)
  <span class="ruby-identifier">board</span>     = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">board</span>(<span class="ruby-identifier">entity_manager</span>)

  <span class="ruby-identifier">piece_array</span> = []
  <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">each_entity</span>(<span class="ruby-constant">OwnedComponent</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">piece</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">piece_array</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">piece</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">piece</span>)
  }
  <span class="ruby-identifier">effects</span> = {}
  <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">effects</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">square</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">result</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">square</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">square</span>)
        <span class="ruby-identifier">effects</span>[<span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;terrain&quot;</span>]] = <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;stats&quot;</span>]  
  }

  <span class="ruby-keyword">return</span> [{
            <span class="ruby-string">&quot;action&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;initGame&quot;</span>,
            <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">board</span>, <span class="ruby-identifier">piece_array</span>, <span class="ruby-identifier">turn_hash</span>, <span class="ruby-identifier">player_hash</span>, <span class="ruby-identifier">player_id</span>, <span class="ruby-identifier">effects</span>]
          }]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-kill_units" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">kill_units</span><span
            class="method-args">(entity_manager, units_array)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method produces a message for the frontend to kill a set of units.</p>

<p>Arguments</p>

<pre class="ruby"><span class="ruby-identifier">entity_manager</span> = <span class="ruby-identifier">the</span> <span class="ruby-identifier">manager</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">entities</span>
<span class="ruby-identifier">units_array</span>    = <span class="ruby-identifier">the</span> <span class="ruby-identifier">entities</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">kill</span>
</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="kill_units-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 243</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">kill_units</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">units_array</span>)
        <span class="ruby-keyword">return</span> [{<span class="ruby-string">&quot;action&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;killUnits&quot;</span>,
                 <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">units_array</span>]}]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-locations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">locations</span><span
            class="method-args">(entity_manager, entity, locations, type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This is the helper function that performs the main work for requests to
determine where a unit can move or attack.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager that contains the entities
entity         = the entity that wishes to move or attack.
locations      = an array of square entities denoting the possible
               squares that can be attacked or moved to</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="locations-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 407</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">locations</span>(<span class="ruby-identifier">entity_manager</span>,  <span class="ruby-identifier">entity</span>, <span class="ruby-identifier">locations</span>, <span class="ruby-identifier">type</span>)
        <span class="ruby-identifier">locations_array</span> = []
        <span class="ruby-identifier">locations</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">square</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">locations_array</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">square_path</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">square</span>)
        }
        <span class="ruby-keyword">return</span> [{<span class="ruby-string">&quot;action&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;highlightSquares&quot;</span>,
                <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">type</span>, <span class="ruby-identifier">locations_array</span>]
                }]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-melee_attack" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">melee_attack</span><span
            class="method-args">(entity_manager, result)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This returns the results of a move command to the frontend. It specifies
the entity that moved along with the path it moved upon.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager that contains the entities
moving_entity  = the entity that moved.
path           = an array of square entities denoting the path of motion.</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="melee_attack-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 351</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">melee_attack</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">result</span>)
        <span class="ruby-identifier">actions</span> = []
        <span class="ruby-identifier">killed_units</span> = []
        <span class="ruby-identifier">update_energy</span> = []
        <span class="ruby-identifier">result</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;melee&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;ranged&quot;</span>
                        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">attack_animate</span>(<span class="ruby-identifier">entity_manager</span>,
                                <span class="ruby-identifier">item</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">item</span>[<span class="ruby-value">2</span>], <span class="ruby-identifier">item</span>[<span class="ruby-value">4</span>], <span class="ruby-identifier">item</span>[<span class="ruby-value">5</span>])
                        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_health</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">item</span>[<span class="ruby-value">3</span>])
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>] <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">entity_manager</span>[<span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>]].<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">and</span>
                            <span class="ruby-identifier">update_energy</span>.<span class="ruby-identifier">empty?</span>)
                                <span class="ruby-identifier">update_energy</span>.<span class="ruby-identifier">concat</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_energy</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>])
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;kill&quot;</span>
                        <span class="ruby-identifier">killed_units</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>]
                <span class="ruby-keyword">end</span>
        }
        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">kill_units</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">killed_units</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">killed_units</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">update_energy</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-melee_attackable_locations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">melee_attackable_locations</span><span
            class="method-args">(entity_manager, melee_entity, locations)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This function is used to return a response to a <a
href="JsonFactory.html#method-c-melee_attackable_locations">::melee_attackable_locations</a>
request. In particular, it contains the list of locations that the
specified entity can melee attack.</p>

<p>Arguments</p>

<pre>entity_manager = the manager that contains the entities
melee_entity  = the entity that wishes to attack.
locations      = an array of square entities denoting the possible
               squares that the entity can melee attack</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="melee_attackable_locations-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 447</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">melee_attackable_locations</span>(<span class="ruby-identifier">entity_manager</span>,  <span class="ruby-identifier">melee_entity</span>, <span class="ruby-identifier">locations</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">locations</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">melee_entity</span>, <span class="ruby-identifier">locations</span>, <span class="ruby-string">&quot;attack&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-move" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">move</span><span
            class="method-args">(entity_manager, moving_entity, path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This returns the results of a move command to the frontend. It specifies
the entity that moved along with the path it moved upon.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager that contains the entities
moving_entity  = the entity that moved.
path           = an array of square entities denoting the path of motion.</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="move-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 293</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">move</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">moving_entity</span>, <span class="ruby-identifier">path</span>)
        <span class="ruby-comment"># path_array = []</span>
        <span class="ruby-comment"># path.each { |square|</span>
        <span class="ruby-comment">#     path_array.push self.square_path(entity_manager, square)</span>
        <span class="ruby-comment"># }</span>
        <span class="ruby-comment"># return {&quot;action&quot; =&gt; &quot;moveUnit&quot;,</span>
        <span class="ruby-comment">#         &quot;arguments&quot; =&gt;[moving_entity, path_array]</span>
        <span class="ruby-comment">#        }</span>

        <span class="ruby-identifier">actions</span> = []
        <span class="ruby-identifier">squares_path</span> = []
        <span class="ruby-identifier">path</span>[<span class="ruby-value">1</span>, <span class="ruby-identifier">path</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">square</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">squares_path</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">square_path</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">square</span>)
        }
        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">push</span>({<span class="ruby-string">&quot;action&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;moveUnit&quot;</span>,
                      <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">moving_entity</span>, <span class="ruby-identifier">squares_path</span>] })
        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_energy</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">moving_entity</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">actions</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-moveable_locations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">moveable_locations</span><span
            class="method-args">(entity_manager, moving_entity, locations)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This function is used to return a response to a <a
href="JsonFactory.html#method-c-moveable_locations">::moveable_locations</a>
request. In particular, it contains the list of locations that the
specified entity can move to.</p>

<p>Arguments</p>

<pre>entity_manager = the manager that contains the entities
moving_entity  = the entity that wishes to move.
locations      = an array of square entities denoting the possible
               squares that can be moved to</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="moveable_locations-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 430</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">moveable_locations</span>(<span class="ruby-identifier">entity_manager</span>,  <span class="ruby-identifier">moving_entity</span>, <span class="ruby-identifier">locations</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">locations</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">moving_entity</span>, <span class="ruby-identifier">locations</span>, <span class="ruby-string">&quot;move&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-piece" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">piece</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method is responsible for converting a piece entity into a json- ready
hash. In short, a piece is any element that a player can control whether it
be an artillery or command_bunker.</p>

<p>This method handles all possible pieces (and hence makes it easier to add
and delete components from a given piece)</p>

<p>Argumetns</p>

<pre>entity_manager = the manager in which the entity is kept.
entity         = the piece entity to be jsoned</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="piece-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">piece</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
        <span class="ruby-identifier">piece_hash</span>          = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;id&quot;</span>]    = <span class="ruby-identifier">entity</span>

        <span class="ruby-identifier">piece_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">PieceComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;type&quot;</span>] = <span class="ruby-identifier">piece_comp</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>

        <span class="ruby-identifier">owned_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">OwnedComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;player&quot;</span>] = <span class="ruby-identifier">owned_comp</span>.<span class="ruby-identifier">owner</span>

        <span class="ruby-identifier">pos_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">PositionComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;y&quot;</span>] = <span class="ruby-identifier">pos_comp</span>.<span class="ruby-identifier">row</span>
        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;x&quot;</span>] = <span class="ruby-identifier">pos_comp</span>.<span class="ruby-identifier">col</span>


        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;stats&quot;</span>] = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>

        <span class="ruby-identifier">health_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">HealthComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;stats&quot;</span>][<span class="ruby-string">&quot;health&quot;</span>] = {<span class="ruby-string">&quot;current&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">health_comp</span>.<span class="ruby-identifier">cur_health</span>,
                                         <span class="ruby-string">&quot;max&quot;</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">health_comp</span>.<span class="ruby-identifier">max_health</span>}

        <span class="ruby-identifier">energy_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">EnergyComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">energy_comp</span>
           <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;stats&quot;</span>][<span class="ruby-string">&quot;energy&quot;</span>] = {<span class="ruby-string">&quot;current&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">energy_comp</span>.<span class="ruby-identifier">cur_energy</span>,
                                            <span class="ruby-string">&quot;max&quot;</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">energy_comp</span>.<span class="ruby-identifier">max_energy</span>}
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">motion_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">MotionComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">motion_comp</span>
           <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;stats&quot;</span>][<span class="ruby-string">&quot;motion&quot;</span>] = {<span class="ruby-string">&quot;cost&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">motion_comp</span>.<span class="ruby-identifier">energy_cost</span>}
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">melee_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">MeleeAttackComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">melee_comp</span>
           <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;stats&quot;</span>][<span class="ruby-string">&quot;melee&quot;</span>] = {<span class="ruby-string">&quot;attack&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">melee_comp</span>.<span class="ruby-identifier">attack</span>,
                                           <span class="ruby-string">&quot;cost&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">melee_comp</span>.<span class="ruby-identifier">energy_cost</span>}
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">range_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">RangeAttackComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;stats&quot;</span>][<span class="ruby-string">&quot;range&quot;</span>] = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">range_comp</span>
           <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;stats&quot;</span>][<span class="ruby-string">&quot;range&quot;</span>] = {<span class="ruby-string">&quot;attack&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">range_comp</span>.<span class="ruby-identifier">attack</span>,
                                           <span class="ruby-string">&quot;min&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">range_comp</span>.<span class="ruby-identifier">min_range</span>,
                                           <span class="ruby-string">&quot;max&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">range_comp</span>.<span class="ruby-identifier">max_range</span>,
                                           <span class="ruby-string">&quot;splash&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">range_comp</span>.<span class="ruby-identifier">splash</span>.<span class="ruby-identifier">size</span>,
                                           <span class="ruby-string">&quot;cost&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">range_comp</span>.<span class="ruby-identifier">energy_cost</span>}
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">range_immune_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">RangeAttackImmunityComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">piece_hash</span>[<span class="ruby-string">&quot;stats&quot;</span>][<span class="ruby-string">&quot;range&quot;</span>][<span class="ruby-string">&quot;immune&quot;</span>] = <span class="ruby-identifier">range_immune_comp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">piece_hash</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-piece_xy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">piece_xy</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method is similar to <a
href="JsonFactory.html#method-c-square_path">::square_path</a> but converts
a unit to its x, y coordinates.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager in which the entity is kept.
entity         = the piece entity to be jsoned</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="piece_xy-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 175</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">piece_xy</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
        <span class="ruby-identifier">pos_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">PositionComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">return</span> {<span class="ruby-string">&quot;y&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pos_comp</span>.<span class="ruby-identifier">row</span>,
                <span class="ruby-string">&quot;x&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pos_comp</span>.<span class="ruby-identifier">col</span>}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-player" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">player</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Converts a player entity into a hash object.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager in which the entity is kept.
entity         = the player entity to be jsoned</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="player-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 67</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">player</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
  <span class="ruby-identifier">name_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">NameComponent</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">user_id_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">UserIdComponent</span>).<span class="ruby-identifier">first</span>

  <span class="ruby-identifier">ai_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">AIComponent</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">player_type</span> = <span class="ruby-string">&quot;CPU&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ai_comp</span>

  <span class="ruby-identifier">human_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">HumanComponent</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">player_type</span> = <span class="ruby-string">&quot;Human&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">human_comp</span>

  <span class="ruby-keyword">return</span> {<span class="ruby-identifier">entity</span>  =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;name&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name_comp</span>.<span class="ruby-identifier">name</span>,
      <span class="ruby-string">&quot;type&quot;</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">player_type</span>,
      <span class="ruby-string">&quot;userId&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_id_comp</span>.<span class="ruby-identifier">id</span>,
      <span class="ruby-string">&quot;gravatar&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_id_comp</span>.<span class="ruby-identifier">gravatar</span>,
      <span class="ruby-string">&quot;faction&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_id_comp</span>.<span class="ruby-identifier">faction</span> }
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-range_attackable_locations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">range_attackable_locations</span><span
            class="method-args">(entity_manager, range_entity, locations)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This function is used to return a response to a range_attackble_locations
request. In particular, it contains the list of locations that the
specified entity can range attack.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager that contains the entities
range_entity  = the entity that wishes to attack.
locations      = an array of square entities denoting the possible
               squares that can range attack</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="range_attackable_locations-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 464</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">range_attackable_locations</span>(<span class="ruby-identifier">entity_manager</span>,  <span class="ruby-identifier">range_entity</span>, <span class="ruby-identifier">locations</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">locations</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">range_entity</span>, <span class="ruby-identifier">locations</span>, <span class="ruby-string">&quot;attack&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-ranged_attack" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ranged_attack</span><span
            class="method-args">(entity_manager, result)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="ranged_attack-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 372</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ranged_attack</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">result</span>)
        <span class="ruby-identifier">actions</span> = []
        <span class="ruby-identifier">killed_units</span> = []
        <span class="ruby-identifier">update_energy</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">attack_animate</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">result</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;ranged&quot;</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attack_animate</span>
                                <span class="ruby-identifier">attack_animate</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">attack_animate</span>(<span class="ruby-identifier">entity_manager</span>,
                                <span class="ruby-identifier">item</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">item</span>[<span class="ruby-value">2</span>], <span class="ruby-identifier">item</span>[<span class="ruby-value">4</span>], <span class="ruby-identifier">item</span>[<span class="ruby-value">5</span>])
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_health</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">item</span>[<span class="ruby-value">3</span>])
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>] <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">entity_manager</span>[<span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>]].<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">and</span>
                           <span class="ruby-operator">!</span><span class="ruby-identifier">update_energy</span>
                                <span class="ruby-identifier">update_energy</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_energy</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>])
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;kill&quot;</span>
                        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">kill_units</span>(<span class="ruby-identifier">entity_manager</span>, [<span class="ruby-identifier">item</span>[<span class="ruby-value">1</span>]])
                <span class="ruby-keyword">end</span>
        }
        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">update_energy</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">attack_animate</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">actions</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-remove_player" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_player</span><span
            class="method-args">(entity_manager, result)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="remove_player-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 508</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">remove_player</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">result</span>)
        <span class="ruby-identifier">remove_player_result</span> = <span class="ruby-identifier">result</span>[<span class="ruby-value">0</span>]
        <span class="ruby-identifier">turn_change_result</span>   = <span class="ruby-identifier">result</span>[<span class="ruby-value">1</span>]
        <span class="ruby-identifier">game_over_result</span>     = <span class="ruby-identifier">result</span>[<span class="ruby-value">2</span>]

        <span class="ruby-identifier">actions</span> = []
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">remove_player_result</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">players_removed</span> = <span class="ruby-identifier">remove_player_result</span>[<span class="ruby-value">1</span>]
                <span class="ruby-identifier">players_removed</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">player</span><span class="ruby-operator">|</span> 
                        <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-string">&quot;actions&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;eliminatePlayer&quot;</span>,
                                                     <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">player</span>] })
                }
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">game_over_result</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">winner</span> = <span class="ruby-identifier">game_over_result</span>[<span class="ruby-value">1</span>]
                <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">push</span>({ <span class="ruby-string">&quot;actions&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;gameOver&quot;</span>, 
                                           <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">winner</span>] })
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">turn_change_result</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">turn</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_entities_with_components</span>(<span class="ruby-constant">TurnComponent</span>).<span class="ruby-identifier">first</span>
                <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">end_turn</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">turn</span>))
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">return</span> <span class="ruby-identifier">actions</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-square" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">square</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Converts a square entity into a hash object.</p>

<p>Arguments</p>

<pre>entity_manager = the manager in which the entity is kept.
entity         = the square entity to be jsoned</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="square-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 23</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">square</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
        <span class="ruby-identifier">terrain_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">TerrainComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">stats_hash</span> = {}
        <span class="ruby-identifier">stats</span>   = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">BoostComponent</span>)
        <span class="ruby-identifier">stats_hash</span>[<span class="ruby-string">&quot;defense&quot;</span>] = <span class="ruby-value">0</span>
        <span class="ruby-identifier">stats_hash</span>[<span class="ruby-string">&quot;move_cost&quot;</span>] = <span class="ruby-value">0</span>
        <span class="ruby-identifier">stats</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">stat</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">stats_hash</span>[<span class="ruby-identifier">stat</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">amount</span>
        }
        <span class="ruby-identifier">terrain_comp</span> = <span class="ruby-identifier">entity_manager</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-constant">TerrainComponent</span>].<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">sprite_comp</span> = <span class="ruby-identifier">entity_manager</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-constant">SpriteComponent</span>].<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">return</span> {<span class="ruby-string">&quot;id&quot;</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entity</span>,
                <span class="ruby-string">&quot;terrain&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">terrain_comp</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>,
                <span class="ruby-string">&quot;stats&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">stats_hash</span>,
                <span class="ruby-string">&quot;index&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sprite_comp</span>.<span class="ruby-identifier">id</span>}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-square_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">square_path</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This converts a square entity into a json-ready hash. In particular, this
will be used for requests such as returning the path of a movement which
don&#39;t need to tell all the information about a square but simply a way
to identify it. Both the id and its x and y coordinates are provided.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager in which the entity is kept.
entity         = the square entity to be jsoned</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="square_path-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 53</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">square_path</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
        <span class="ruby-identifier">pos_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">PositionComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">return</span> {<span class="ruby-string">&quot;y&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pos_comp</span>.<span class="ruby-identifier">row</span>,
                <span class="ruby-string">&quot;x&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pos_comp</span>.<span class="ruby-identifier">col</span>}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-turn" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">turn</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Converts a turn entity into a hash object.</p>

<p>Argumetns</p>

<pre>entity_manager = the manager in which the entity is kept.
entity         = the turn entity to be jsoned</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="turn-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">turn</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
        <span class="ruby-identifier">turn_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">TurnComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">return</span> {<span class="ruby-string">&quot;playerid&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">turn_comp</span>.<span class="ruby-identifier">current_turn</span>,
                <span class="ruby-string">&quot;turnCount&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">turn_comp</span>.<span class="ruby-identifier">turn_count</span>}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-update_energy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_energy</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method sends a request to the frontend to update energy.</p>

<p>Arguments</p>

<pre class="ruby"><span class="ruby-identifier">entity_manager</span> = <span class="ruby-identifier">the</span> <span class="ruby-identifier">manager</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">entities</span>
<span class="ruby-identifier">entity</span>         = <span class="ruby-identifier">the</span> <span class="ruby-identifier">entity</span> <span class="ruby-identifier">who</span> <span class="ruby-identifier">lost</span> <span class="ruby-identifier">energy</span>
</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="update_energy-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 211</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_energy</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
        <span class="ruby-identifier">energy_comp</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">EnergyComponent</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">return</span> [{<span class="ruby-string">&quot;action&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;updateUnitEnergy&quot;</span>,
                 <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">entity</span>, <span class="ruby-identifier">energy_comp</span>.<span class="ruby-identifier">cur_energy</span>]}]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-update_health" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_health</span><span
            class="method-args">(entity_manager, entity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method sends a request to the frontend to update health.</p>

<p>Arguments</p>

<pre class="ruby"><span class="ruby-identifier">entity_manager</span> = <span class="ruby-identifier">the</span> <span class="ruby-identifier">manager</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">entities</span>
<span class="ruby-identifier">entity</span>         = <span class="ruby-identifier">the</span> <span class="ruby-identifier">entity</span> <span class="ruby-identifier">who</span> <span class="ruby-identifier">lost</span> <span class="ruby-identifier">health</span>
</pre>

<p>Returns</p>

<pre class="ruby"><span class="ruby-constant">A</span> <span class="ruby-identifier">hash</span> <span class="ruby-identifier">that</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">ready</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">jsoned</span>
</pre>
          
          

          
          <div class="method-source-code" id="update_health-source">
            <pre><span class="ruby-comment"># File app/models/ecs/entity/json_factory.rb, line 226</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_health</span>(<span class="ruby-identifier">entity_manager</span>, <span class="ruby-identifier">entity</span>)
        <span class="ruby-identifier">cur_health</span> = <span class="ruby-value">0</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">has_key?</span> (<span class="ruby-identifier">entity</span>) <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">entity_manager</span>[<span class="ruby-identifier">entity</span>].<span class="ruby-identifier">empty?</span>
                <span class="ruby-identifier">cur_health</span> = <span class="ruby-identifier">entity_manager</span>.<span class="ruby-identifier">get_components</span>(<span class="ruby-identifier">entity</span>, <span class="ruby-constant">HealthComponent</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">cur_health</span>
<span class="ruby-keyword">end</span>
        <span class="ruby-keyword">return</span> [{<span class="ruby-string">&quot;action&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;updateUnitHealth&quot;</span>,
                 <span class="ruby-string">&quot;arguments&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">entity</span>, <span class="ruby-identifier">cur_health</span>]}]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

